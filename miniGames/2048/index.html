<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">

    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 Game</title>
    <a href="/index.html" class="corner-link">killmytime</a>  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .corner-link {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            text-decoration: none;
            color: #000;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .corner-link:hover {
            transform: scale(1.1);
            color: #666;
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .score-container {
            display: flex;
            gap: 1rem;
            position: relative;
            right: -50px;
            margin-bottom: 1.5rem;
        }

        .score-box {
            background: #fff;
            padding: 1rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .score-box p {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .score-box span {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .game-container {
            background: #fff;
            padding: 1rem;
            position: relative;
            top: -75px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            background: #bbada0;
            padding: 12px;
            border-radius: 8px;
        }

        .cell {
            width: 80px;
            height: 80px;
            background: #cdc1b4;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 600;
            color: #776e65;
            transition: all 0.15s ease;
        }

        .cell[data-value="2"] { background: #eee4da; }
        .cell[data-value="4"] { background: #ede0c8; }
        .cell[data-value="8"] { background: #f2b179; color: #f9f6f2; }
        .cell[data-value="16"] { background: #f59563; color: #f9f6f2; }
        .cell[data-value="32"] { background: #f67c5f; color: #f9f6f2; }
        .cell[data-value="64"] { background: #f65e3b; color: #f9f6f2; }
        .cell[data-value="128"] { background: #edcf72; color: #f9f6f2; font-size: 1.6rem; }
        .cell[data-value="256"] { background: #edcc61; color: #f9f6f2; font-size: 1.6rem; }
        .cell[data-value="512"] { background: #edc850; color: #f9f6f2; font-size: 1.6rem; }
        .cell[data-value="1024"] { background: #edc53f; color: #f9f6f2; font-size: 1.4rem; }
        .cell[data-value="2048"] { background: #edc22e; color: #f9f6f2; font-size: 1.4rem; }

        .controls {
            margin-top: 1.5rem;
            text-align: center;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        button {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #34495e;
        }

        input {
            background: #6083a760;
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            position: relative;
            top: -10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .button1 {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            top: 450px;
            transition: background 0.3s ease;
        }

        .button1:hover {
            background: #34495e;
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .game-over.show {
            display: flex;
        }

        .game-over-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .game-over h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .new-best-score {
            color: #27ae60;
            font-weight: 600;
            margin: 0.5rem 0;
            font-size: 1.2rem;
        }

        .game-over .final-score {
            margin: 1rem 0;
            font-size: 1.1rem;
            color: #666;
        }

        .game-over .score-highlight {
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .how-to-play {
            max-width: 400px;
            margin: 1rem auto;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.281);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .how-to-play p {
            color: #666;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .how-to-play ul {
            list-style-type: none;
            padding: 0;
        }

        .how-to-play li {
            color: #666;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .how-to-play li:before {
            content: "‚Ä¢";
            color: #2c3e50;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            pointer-events: none;
            opacity: 0;
            animation: confetti-fall 3s ease-in-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 500px) {
            .cell {
                width: 65px;
                height: 65px;
                font-size: 1.5rem;
            }
        }

        .leaderboard-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            visibility: visible;
            opacity: 1;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .leaderboard-container.hidden {
            visibility: hidden;
            opacity: 0;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            color: #666;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: #2c3e50;
            color: white;
        }

        .leaderboard {
            max-height: 400px;
            overflow-y: auto;
        }

        .leaderboard-entry {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .entry-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .country-flag {
            width: 24px;
            height: 16px;
            border-radius: 2px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>2048</h1>
        <div class="score-container">
            <div class="score-box">
                <p>SCORE</p>
                <span id="score">0</span>
            </div>
            <div class="score-box">
                <p>BEST</p>
                <span id="best-score">0</span>
            </div>
        </div>
        <div class="controls">
            <button class="button1" onclick="resetGame()">New Game</button>
            <button class="button1" onclick="toggleLeaderboard()">üèÜ Leaderboard</button>
        </div>

        <div class="leaderboard-container hidden">
            <h2 style="margin-bottom: 1rem; text-align: center;">Leaderboard</h2>
            <div class="leaderboard-tabs">
                <button class="tab-button active" onclick="switchLeaderboardTab('players')">Players</button>
                <button class="tab-button" onclick="switchLeaderboardTab('countries')">Countries</button>
            </div>
            <div id="leaderboard" class="leaderboard">
                <div class="loading">Loading scores...</div>
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="grid" id="grid"></div>
    </div>

    <div class="how-to-play">
        <p>Join the numbers and get to the 2048 tile!</p>
        <p>Use your arrow keys or swipe to move tiles.</p>
        <ul>
            <li>Use arrow keys (‚Üë ‚Üê ‚Üì ‚Üí) or swipe to move all tiles</li>
            <li>When two tiles with the same number touch, they merge into one!</li>
            <li>Add them up to reach 2048</li>
        </ul>
    </div>

    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2 id="gameOverText">Game Over!</h2>
            <div id="newBestScore" class="new-best-score" style="display: none;">
                üèÜ New Best Score! üèÜ
            </div>
            <div class="final-score">
                Final Score: <span class="score-highlight" id="finalScore">0</span><br>
                Best Score: <span class="score-highlight" id="endBestScore">0</span>
            </div>
            <div class="submit-score">
                <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                <button onclick="submitScore()">Submit Score</button>
            </div>
            <button onclick="resetGame()">Try Again</button>
        </div>
    </div>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LHBVWHRTC6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LHBVWHRTC6');
</script>

    <script>
        let grid = [];
        let score = 0;
        let bestScore = 0;
        let leaderboardData = [];

        // Clear localStorage on first load to reset any invalid data
        if (!localStorage.getItem('2048-best-score')) {
            localStorage.setItem('2048-best-score', '0');
        }

        function initializeBestScore() {
            try {
                const savedScore = localStorage.getItem('2048-best-score');
                bestScore = savedScore ? parseInt(savedScore) : 0;
                if (isNaN(bestScore)) bestScore = 0;
                document.getElementById('best-score').textContent = bestScore;
            } catch (e) {
                bestScore = 0;
                localStorage.setItem('2048-best-score', '0');
                document.getElementById('best-score').textContent = '0';
            }
        }

        let hasWon = false;

        function createConfetti() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 30000);
            }
        }

        function checkForWin() {
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] >= 2048) {
                        return true;
                    }
                }
            }
            return false;
        }

        function moveLeft() {
            let moved = false;
            for (let i = 0; i < 4; i++) {
                let row = grid[i].filter(x => x !== 0);
                for (let j = 0; j < row.length - 1; j++) {
                    if (row[j] === row[j + 1]) {
                        row[j] *= 2;
                        updateScore(score + row[j]);
                        row.splice(j + 1, 1);
                        moved = true;
                    }
                }
                while (row.length < 4) row.push(0);
                if (row.join(',') !== grid[i].join(',')) moved = true;
                grid[i] = row;
            }
            return moved;
        }

        function rotate() {
            const rotated = Array(4).fill().map(() => Array(4).fill(0));
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    rotated[i][j] = grid[j][3 - i];
                }
            }
            grid = rotated;
        }

        function move(direction) {
            let moved = false;

            if (direction === 'ArrowLeft') {
                moved = moveLeft();
            } else if (direction === 'ArrowRight') {
                grid = grid.map(row => row.reverse());
                moved = moveLeft();
                grid = grid.map(row => row.reverse());
            } else if (direction === 'ArrowUp') {
                rotate();
                moved = moveLeft();
                rotate();
                rotate();
                rotate();
            } else if (direction === 'ArrowDown') {
                rotate();
                rotate();
                rotate();
                moved = moveLeft();
                rotate();
            }

            if (moved) {
                addNewNumber();
                updateDisplay();
                
                // Check if game is over
                if (isGameOver()) {
                    setTimeout(() => {
                        showGameEndScreen();
                    }, 100);
                }
            }
        }

        function updateScore(newScore) {
            score = newScore;
            document.getElementById('score').textContent = score;
            
            if (score > bestScore) {
                bestScore = score;
                document.getElementById('best-score').textContent = bestScore;
            }
        }

        function showGameEndScreen(gameEnded = true) {
            const gameOverText = document.getElementById('gameOverText');
            const finalScore = document.getElementById('finalScore');
            const endBestScore = document.getElementById('endBestScore');
            const newBestScore = document.getElementById('newBestScore');

            finalScore.textContent = score;
            endBestScore.textContent = bestScore;

            // Check if score is over 2048 for congratulations message
            if (score >= 2048) {
                gameOverText.textContent = 'Congratulations!';
            } else {
                gameOverText.textContent = 'Game Over!';
            }

            // Show confetti and new best score message if score beats best score
            const savedBestScore = parseInt(localStorage.getItem('2048-best-score')) || 0;
            if (score > savedBestScore) {
                setTimeout(createConfetti, 100);
                localStorage.setItem('2048-best-score', score.toString());
                newBestScore.style.display = 'block';
            } else {
                newBestScore.style.display = 'none';
            }

            document.getElementById('gameOver').classList.add('show');
        }

        function initializeGrid() {
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = '';
            grid = Array(4).fill().map(() => Array(4).fill(0));
            hasWon = false;
            
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.setAttribute('data-row', i);
                    cell.setAttribute('data-col', j);
                    gridElement.appendChild(cell);
                }
            }
            
            addNewNumber();
            addNewNumber();
            updateDisplay();
        }

        function addNewNumber() {
            const emptyCells = [];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] === 0) {
                        emptyCells.push({i, j});
                    }
                }
            }
            
            if (emptyCells.length > 0) {
                const {i, j} = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                grid[i][j] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function updateDisplay() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = parseInt(cell.getAttribute('data-row'));
                const col = parseInt(cell.getAttribute('data-col'));
                const value = grid[row][col];
                
                cell.textContent = value || '';
                cell.setAttribute('data-value', value);
            });
            
            document.getElementById('score').textContent = score;
            document.getElementById('best-score').textContent = bestScore;
        }

        function isGameOver() {
            // Check for empty cells
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] === 0) return false;
                }
            }
            
            // Check for possible merges
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (j < 3 && grid[i][j] === grid[i][j + 1]) return false;
                    if (i < 3 && grid[i][j] === grid[i + 1][j]) return false;
                }
            }
            
            return true;
        }

        function resetGame() {
            score = 0;
            document.getElementById('score').textContent = '0';
            document.getElementById('gameOver').classList.remove('show');
            hasWon = false;
            initializeGrid();
            updateLeaderboard();
        }

        document.addEventListener('keydown', (e) => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                move(e.key);
            }
        });

        // Touch controls
        let touchStartX, touchStartY;
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            if (!touchStartX || !touchStartY) return;

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;

            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;

            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                if (deltaX > 0) move('ArrowRight');
                else move('ArrowLeft');
            } else {
                if (deltaY > 0) move('ArrowDown');
                else move('ArrowUp');
            }

            touchStartX = null;
            touchStartY = null;
        });

        // Initialize the game
        window.addEventListener('load', () => {
            initializeBestScore();
            initializeGrid();
            updateLeaderboard();
            // Start auto-refresh of leaderboard
            setInterval(updateLeaderboard, 30000); // Updates every 30 seconds
            
            // Ensure leaderboard is hidden initially
            document.querySelector('.leaderboard-container').classList.add('hidden');
            
            // Add click outside to close
            document.addEventListener('click', (e) => {
                const container = document.querySelector('.leaderboard-container');
                const button = e.target.closest('button');
                
                if (!container.contains(e.target) && 
                    !button?.textContent.includes('Leaderboard')) {
                    container.classList.add('hidden');
                }
            });
        });

        // Add these at the top of your JavaScript, replace with your actual credentials
        const SUPABASE_URL = 'https://rcagbgmdmuoxvziumqrx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjYWdiZ21kbXVveHZ6aXVtcXJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ5NTczNjksImV4cCI6MjA1MDUzMzM2OX0.jw60EiOrxG8_Ou8RkWaVOoZxqo-Ky6vMrQ9S5ftl18w';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Add this function to get user's country
        async function getUserCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return data.country_name || 'Unknown';
            } catch (error) {
                console.error('Error fetching country:', error);
                return 'Unknown';
            }
        }

        // Update the submitScore function with proper error handling and data validation
        async function submitScore() {
            const nameInput = document.getElementById('playerName');
            const playerName = nameInput.value.trim();
            
            if (!playerName) {
                alert('Please enter your name!');
                return;
            }

            try {
                const country = await getUserCountry();
                
                const scoreData = {
                    name: playerName,
                    score: parseInt(score),
                    country: country || 'Unknown'
                };

                console.log('Attempting to submit score with:', scoreData);

                // Insert score into Supabase
                const { data, error } = await supabase
                    .from('scores')
                    .insert([scoreData])
                    .select();

                if (error) {
                    console.error('Supabase error details:', {
                        code: error.code,
                        message: error.message,
                        details: error.details,
                        hint: error.hint
                    });
                    throw error;
                }

                console.log('Score submitted successfully:', data);
                await updateLeaderboard();
                document.getElementById('gameOver').classList.remove('show');
                resetGame();
            } catch (error) {
                console.error('Full error object:', error);
                alert('Failed to submit score. Please try again.');
            }
        }

        // Add these new functions and update existing ones
        let currentLeaderboardTab = 'players';

        function switchLeaderboardTab(tab) {
            currentLeaderboardTab = tab;
            // Update active tab styling
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.toggle('active', button.innerText.toLowerCase().includes(tab));
            });
            updateLeaderboard();
        }

        async function updateLeaderboard() {
            const leaderboardElement = document.getElementById('leaderboard');
            leaderboardElement.innerHTML = '<div class="loading">Loading scores...</div>';

            try {
                console.log('Fetching leaderboard data...');
                const { data: scores, error } = await supabase
                    .from('scores')
                    .select('*')
                    .order('score', { ascending: false });

                if (error) {
                    console.error('Supabase fetch error:', error);
                    throw error;
                }

                console.log('Received scores:', scores);

                if (!scores || scores.length === 0) {
                    leaderboardElement.innerHTML = '<div class="no-scores">No scores yet!</div>';
                    return;
                }

                if (currentLeaderboardTab === 'players') {
                    displayPlayerLeaderboard(scores.slice(0, 10));
                } else {
                    displayCountryLeaderboard(scores);
                }
            } catch (error) {
                console.error('Leaderboard error:', error);
                leaderboardElement.innerHTML = '<div class="error">Failed to load leaderboard</div>';
            }
        }

        function displayPlayerLeaderboard(scores) {
            const leaderboardElement = document.getElementById('leaderboard');
            leaderboardElement.innerHTML = scores
                .map((entry, index) => {
                    const countryCode = getCountryCode(entry.country);
                    return `
                        <div class="leaderboard-entry">
                            <div class="entry-left">
                                <span>${index + 1}.</span>
                                <img 
                                    class="country-flag" 
                                    src="https://flagcdn.com/w40/${countryCode.toLowerCase()}.png"
                                    alt="${entry.country} flag - 2048 game player country"
                                    title="${entry.country}"
                                >
                                <span>${entry.name}</span>
                            </div>
                            <span>${entry.score}</span>
                        </div>
                    `;
                })
                .join('');
        }

        function displayCountryLeaderboard(scores) {
            const countryScores = scores.reduce((acc, score) => {
                const country = score.country || 'Unknown';
                if (!acc[country]) {
                    acc[country] = {
                        totalScore: 0,
                        count: 0,
                        highestScore: 0
                    };
                }
                acc[country].totalScore += score.score;
                acc[country].count += 1;
                acc[country].highestScore = Math.max(acc[country].highestScore, score.score);
                return acc;
            }, {});

            const countryRankings = Object.entries(countryScores)
                .map(([country, data]) => ({
                    country,
                    totalScore: data.totalScore,
                    count: data.count,
                    highestScore: data.highestScore,
                    averageScore: Math.round(data.totalScore / data.count)
                }))
                .sort((a, b) => b.totalScore - a.totalScore);

            const leaderboardElement = document.getElementById('leaderboard');
            leaderboardElement.innerHTML = countryRankings
                .map((entry, index) => {
                    const countryCode = getCountryCode(entry.country);
                    return `
                        <div class="leaderboard-entry">
                            <div class="entry-left">
                                <span>${index + 1}.</span>
                                <img 
                                    class="country-flag" 
                                    src="https://flagcdn.com/w40/${countryCode.toLowerCase()}.png"
                                    alt="${entry.country} flag - 2048 game country ranking"
                                    title="${entry.country}"
                                >
                                <span>${entry.country}</span>
                            </div>
                            <div class="entry-right">
                                <div class="score-details">
                                    <span title="Total Score">üèÜ ${entry.totalScore}</span>
                                    <span title="Players">(${entry.count} players)</span>
                                </div>
                            </div>
                        </div>
                    `;
                })
                .join('');
        }

        // Update the getCountryCode function with more countries
        function getCountryCode(countryName) {
            const countryMap = {
                'Afghanistan': 'af', 'Albania': 'al', 'Algeria': 'dz', 'Azerbaijan': 'az',
                'United States': 'us', 'United Kingdom': 'gb', 'Turkey': 'tr',
                'Russia': 'ru', 'Germany': 'de', 'France': 'fr', 'Italy': 'it',
                'Spain': 'es', 'China': 'cn', 'Japan': 'jp', 'South Korea': 'kr',
                'Canada': 'ca', 'Australia': 'au', 'Brazil': 'br', 'India': 'in',
                'Mexico': 'mx', 'Argentina': 'ar', 'South Africa': 'za', 'Egypt': 'eg',
                'Saudi Arabia': 'sa', 'UAE': 'ae', 'Singapore': 'sg', 'Malaysia': 'my',
                'Indonesia': 'id', 'Thailand': 'th', 'Vietnam': 'vn', 'Philippines': 'ph',
                // Add more as needed
            };
            return countryMap[countryName] || 'un';
        }

        // Add these functions to your JavaScript
        function toggleLeaderboard() {
            const container = document.querySelector('.leaderboard-container');
            const isHidden = container.classList.contains('hidden');
            
            container.classList.toggle('hidden');
            
            if (!isHidden) {
                updateLeaderboard();
            }
            
            console.log('Leaderboard visibility:', !isHidden);
        }

        // Add these functions for drag functionality
        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            const header = element.querySelector('h2');
            
            if (header) {
                header.style.cursor = 'move';
                header.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e.preventDefault();
                // Get mouse position at startup
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                
                // Add dragging class
                element.classList.add('dragging');
            }

            function elementDrag(e) {
                e.preventDefault();
                // Calculate new position
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // Set element's new position
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // Stop moving when mouse button is released
                document.onmouseup = null;
                document.onmousemove = null;
                element.classList.remove('dragging');
            }
        }

        // Update the window.addEventListener to include draggable initialization
        window.addEventListener('load', () => {
            // ... your existing initialization code ...
            
            // Make leaderboard draggable
            const leaderboard = document.querySelector('.leaderboard-container');
            makeDraggable(leaderboard);
            
            // Ensure leaderboard is hidden initially
            leaderboard.classList.add('hidden');
            
            // Update click outside handler to not close when dragging
            document.addEventListener('click', (e) => {
                const container = document.querySelector('.leaderboard-container');
                const button = e.target.closest('button');
                
                if (!container.contains(e.target) && 
                    !button?.textContent.includes('Leaderboard') &&
                    !container.classList.contains('dragging')) {
                    container.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
